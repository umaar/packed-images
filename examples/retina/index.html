<!doctype html>
<html>
<head>
<script type="text/javascript">
var timeline = [{"delay": 103, "blit": [[0, 0, 1130, 1200, 0, 0]]}, {"delay": 99, "blit": []}, {"delay": 101, "blit": []}, {"delay": 100, "blit": []}, {"delay": 99, "blit": []}, {"delay": 101, "blit": [[1050, 2798, 20, 22, 744, 878]]}, {"delay": 101, "blit": []}, {"delay": 101, "blit": []}, {"delay": 101, "blit": []}, {"delay": 101, "blit": []}, {"delay": 99, "blit": []}, {"delay": 101, "blit": []}, {"delay": 100, "blit": []}, {"delay": 101, "blit": []}, {"delay": 101, "blit": [[897, 2895, 34, 34, 9, 611], [0, 2972, 1130, 6, 0, 1194]]}, {"delay": 100, "blit": [[794, 2874, 35, 34, 9, 611], [0, 2980, 1130, 2, 0, 648], [1097, 2623, 20, 22, 744, 878]]}, {"delay": 101, "blit": []}, {"delay": 100, "blit": []}, {"delay": 101, "blit": []}, {"delay": 100, "blit": []}, {"delay": 101, "blit": []}, {"delay": 99, "blit": []}, {"delay": 101, "blit": [[863, 2895, 34, 34, 17, 613]]}, {"delay": 101, "blit": [[1033, 2892, 34, 34, 17, 613]]}, {"delay": 100, "blit": []}, {"delay": 101, "blit": []}, {"delay": 101, "blit": []}, {"delay": 100, "blit": []}, {"delay": 100, "blit": [[1097, 2552, 25, 27, 19, 613]]}, {"delay": 101, "blit": [[0, 1904, 1130, 330, 0, 268]]}, {"delay": 101, "blit": [[0, 1574, 1130, 330, 0, 268]]}, {"delay": 100, "blit": [[0, 1200, 1130, 374, 0, 224]]}, {"delay": 100, "blit": []}, {"delay": 100, "blit": []}, {"delay": 101, "blit": []}, {"delay": 101, "blit": []}, {"delay": 99, "blit": [[999, 2892, 34, 34, 333, 261], [0, 2650, 1130, 35, 0, 648], [0, 2234, 700, 277, 0, 684], [1106, 2234, 20, 218, 706, 774], [83, 2511, 124, 27, 236, 962], [843, 2490, 143, 19, 90, 966], [1067, 2904, 55, 19, 362, 966], [0, 2511, 571, 139, 129, 990], [700, 2490, 143, 19, 90, 994], [700, 2729, 235, 50, 391, 994], [999, 2872, 69, 20, 558, 994], [938, 2849, 83, 23, 110, 1022], [794, 2851, 69, 23, 628, 1022], [1097, 2579, 14, 44, 90, 1024], [1050, 2729, 69, 43, 84, 1055], [414, 2595, 157, 51, 543, 1074], [1057, 2490, 40, 14, 84, 1111]]}, {"delay": 101, "blit": [[333, 1237, 34, 34, 333, 261], [19, 613, 25, 25, 19, 613], [0, 2978, 1130, 2, 0, 648]]}, {"delay": 101, "blit": []}, {"delay": 99, "blit": []}, {"delay": 100, "blit": []}, {"delay": 101, "blit": []}, {"delay": 100, "blit": [[571, 2511, 526, 137, 240, 215], [0, 2739, 694, 52, 6, 822]]}, {"delay": 101, "blit": [[6, 2372, 694, 52, 6, 822]]}, {"delay": 102, "blit": []}, {"delay": 100, "blit": []}, {"delay": 99, "blit": [[240, 215, 336, 51, 240, 215]]}, {"delay": 100, "blit": []}, {"delay": 101, "blit": []}, {"delay": 100, "blit": []}, {"delay": 100, "blit": []}, {"delay": 101, "blit": []}, {"delay": 101, "blit": []}, {"delay": 101, "blit": []}, {"delay": 100, "blit": [[706, 962, 20, 30, 1106, 782], [0, 2685, 700, 54, 0, 876], [794, 2815, 144, 36, 357, 1162], [645, 1162, 79, 36, 575, 1162], [202, 1170, 255, 23, 78, 1170], [986, 2490, 71, 21, 502, 1170]]}, {"delay": 100, "blit": [[700, 2815, 94, 94, 323, 865]]}, {"delay": 100, "blit": [[956, 2729, 94, 94, 323, 865]]}, {"delay": 101, "blit": [[828, 2509, 128, 1, 58, 607], [0, 2835, 700, 44, 0, 902]]}, {"delay": 99, "blit": []}, {"delay": 100, "blit": []}, {"delay": 101, "blit": []}, {"delay": 99, "blit": []}, {"delay": 100, "blit": []}, {"delay": 101, "blit": []}, {"delay": 101, "blit": []}, {"delay": 100, "blit": []}, {"delay": 100, "blit": []}, {"delay": 101, "blit": [[700, 2685, 364, 44, 326, 902]]}, {"delay": 101, "blit": []}, {"delay": 100, "blit": []}, {"delay": 101, "blit": [[1064, 2685, 56, 44, 326, 902]]}, {"delay": 101, "blit": [[965, 2872, 34, 44, 362, 902]]}, {"delay": 101, "blit": [[931, 2872, 34, 44, 376, 902]]}, {"delay": 100, "blit": [[1070, 2860, 34, 44, 390, 902]]}, {"delay": 101, "blit": []}, {"delay": 101, "blit": [[897, 2851, 34, 44, 404, 902]]}, {"delay": 101, "blit": [[863, 2851, 34, 44, 418, 902]]}, {"delay": 101, "blit": []}, {"delay": 100, "blit": [[1070, 2816, 34, 44, 432, 902]]}, {"delay": 101, "blit": []}, {"delay": 101, "blit": []}, {"delay": 100, "blit": []}, {"delay": 101, "blit": []}, {"delay": 100, "blit": [[300, 2454, 2, 28, 446, 904]]}, {"delay": 101, "blit": []}, {"delay": 100, "blit": [[1070, 2772, 34, 44, 446, 902]]}, {"delay": 101, "blit": []}, {"delay": 100, "blit": []}, {"delay": 100, "blit": []}, {"delay": 101, "blit": [[731, 2266, 102, 21, 271, 256], [569, 256, 272, 26, 377, 256], [938, 2823, 93, 26, 650, 256], [0, 2791, 700, 44, 0, 902]]}, {"delay": 101, "blit": []}, {"delay": 99, "blit": []}, {"delay": 101, "blit": []}, {"delay": 101, "blit": []}, {"delay": 101, "blit": []}, {"delay": 100, "blit": []}, {"delay": 101, "blit": []}, {"delay": 101, "blit": []}, {"delay": 101, "blit": []}, {"delay": 100, "blit": []}, {"delay": 101, "blit": []}, {"delay": 101, "blit": [[700, 2362, 406, 128, 240, 224], [0, 2940, 694, 26, 6, 876]]}, {"delay": 101, "blit": []}, {"delay": 101, "blit": []}, {"delay": 100, "blit": []}, {"delay": 101, "blit": []}, {"delay": 100, "blit": []}, {"delay": 101, "blit": []}, {"delay": 100, "blit": [[829, 2874, 34, 34, 363, 867]]}, {"delay": 102, "blit": [[1106, 782, 20, 30, 1106, 782], [0, 2879, 700, 35, 0, 867], [0, 2914, 700, 26, 0, 904], [700, 2779, 256, 36, 344, 1162]]}, {"delay": 100, "blit": []}, {"delay": 99, "blit": []}, {"delay": 101, "blit": []}, {"delay": 101, "blit": []}, {"delay": 101, "blit": []}, {"delay": 100, "blit": []}, {"delay": 101, "blit": []}, {"delay": 101, "blit": []}, {"delay": 101, "blit": []}, {"delay": 100, "blit": [[700, 2234, 406, 128, 240, 224]]}, {"delay": 101, "blit": [[1050, 2772, 20, 100, 744, 1000]]}, {"delay": 101, "blit": [[1106, 2452, 20, 100, 744, 1000]]}, {"delay": 101, "blit": []}, {"delay": 101, "blit": []}, {"delay": 100, "blit": []}, {"delay": 101, "blit": []}, {"delay": 101, "blit": []}, {"delay": 101, "blit": []}, {"delay": 100, "blit": []}, {"delay": 101, "blit": [[700, 2509, 128, 1, 58, 614], [0, 648, 1130, 2, 0, 648], [0, 2426, 700, 26, 0, 876], [0, 2966, 1130, 6, 0, 1194]]}, {"delay": 101, "blit": []}, {"delay": 4000, "blit": []}]
var delay_scale = 0.7
var timer = null
var ctx;
var ratio = 1;

var animate = function(img, timeline, element)
{
	var i = 0

	var run_time = 0
	for (var j = 0; j < timeline.length - 1; ++j)
		run_time += timeline[j].delay

	var f = function()
	{
		var frame = i++ % timeline.length
		var delay = timeline[frame].delay * delay_scale
		var blits = timeline[frame].blit

		ctx = element.getContext('2d')

		for (j = 0; j < blits.length; ++j)
		{
			var blit = blits[j]
			var sx = blit[0]
			var sy = blit[1]
			var w = blit[2]
			var h = blit[3]
			var dx = blit[4]
			var dy = blit[5]
			ctx.drawImage(img, sx, sy, w, h, dx, dy, w, h)
		}

		timer = window.setTimeout(f, delay)
	}

	if (timer) window.clearTimeout(timer)
	f()
}

function set_animation(img_url, timeline, canvas_id, fallback_id)
{
	var img = new Image()
	img.onload = function()
	{
		var canvas = document.getElementById(canvas_id)
		if (canvas && canvas.getContext) {
			ctx = canvas.getContext('2d');
			ctx.scale(1, 1);
			animate(img, timeline, canvas)
		}
	}
	img.src = img_url
}
</script>
</head>
<body>
<style>
	canvas {
		width: 565px;
		height: 600px;
		border: 1px solid grey;
	}
</style>

<div><canvas id="anim_target" class="anim_target" width="1130" height="1200">
<p></canvas></div>

<script>
set_animation("retina.png", timeline, 'anim_target', 'anim_fallback');
</script>
</body>
